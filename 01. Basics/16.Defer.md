# Defer

- We have a function. From this function, we are calling another function. But that another function should only be executed when the first function completes or panics.
- Postpones the execution of a function untill surrouding function returns or finishes execution or panics.
- Do this cleanup at the end no matter how the function returns.
- Useful to close database or file connections after work is done.
- Do some core logic and once you are done with that, execute this function for cleanup or logging purpose.


## Syntax

```go
func process(i int) {
	defer cleanup()
	fmt.Println("Normal execution", i)
}

func cleanup() {
	fmt.Println("CLEANUP FUNCTION")
}

// Normal execution 10
// CLEANUP FUNCTION
```

- Arguments passed to deferred function are evaluated based on where they are written. Because its possible that the variable gets modified later during function execution.

```go
func process(i int) {
	defer cleanup(i)
	i++
	fmt.Println("Normal execution", i)
}

func cleanup(num int) {
	fmt.Println("CLEANUP FUNCTION", num)
}

// Normal execution 11
// CLEANUP FUNCTION 10
```

- If there are multiple defer statements in one function they are evaluated in a LIFO(Upwards arrow).

```go
func process(i int) {
	defer fmt.Println("First defer")
	defer fmt.Println("Second defer")
	defer fmt.Println("Third defer")

	fmt.Println("Normal execution", i)
}

/*
Normal execution 10
Third defer
Second defer
First defer
*/
```
