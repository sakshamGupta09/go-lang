# Defer

- Postpones the execution of a function untill surrouding function returns or finishes execution or panics.
- It’s mainly used for cleanup and resource management — and it guarantees execution even if the function exits early.
- Without defer, you'd need cleanup code before every return statement.
- Sometimes after performing a long task we forget to write cleanup in the end. With defer we can write cleanup logic write after allocating resources than at the end.

## Syntax

```go
func process(i int) {
	defer cleanup()
	fmt.Println("Normal execution", i)
}

func cleanup() {
	fmt.Println("CLEANUP FUNCTION")
}

// Normal execution 10
// CLEANUP FUNCTION
```

- Arguments passed to deferred function are evaluated based on where they are written. Because its possible that the variable gets modified later during function execution.
- Because whenever we call a function, we pass a copy of value not the original value.

```go
func process(i int) {
	defer cleanup(i)
	i++
	fmt.Println("Normal execution", i)
}

func cleanup(num int) {
	fmt.Println("CLEANUP FUNCTION", num)
}

// Normal execution 11
// CLEANUP FUNCTION 10
```

- If there are multiple defer statements in one function they are evaluated in a LIFO(Upwards arrow).

```go
func process(i int) {
	defer fmt.Println("First defer")
	defer fmt.Println("Second defer")
	defer fmt.Println("Third defer")

	fmt.Println("Normal execution", i)
}

/*
Normal execution 10
Third defer
Second defer
First defer
*/
```
